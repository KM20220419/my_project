# 数据库连接池

<img src="C:\Users\王者荣耀\AppData\Roaming\Typora\typora-user-images\image-20251003163500869.png" alt="image-20251003163500869" style="zoom:50%;" />

其核心思想就是：在程序启动或者运行期间，提前建立好一批数据库连接。将它们存放在一个“池子”里，等应用要访问数据库时，直接使用现成的连接，而不是再去新建连接（建立连接也需要三次握手等）。

## my_spl_connection_pool.h

## 头文件

`<list>` 用来存放连接池里的连接。

`<mysql/mysql.h>` MySQL C API 的头文件，里面有 `MYSQL` 类型和相关操作函数。



数据库连接池的实现使用的也是单例模式，因为在整个程序运行期间，只需要有一个实例就行。

## RAII思想

RAII：资源获取即初始化（Resource Acquisition Is Initialization）。意思是：把资源的申请与释放，与对象的生命周期绑定起来。

- 当对象被创建（构造函数执行）时，就申请资源。
- 当对象销毁（析构函数执行）时，就释放资源

在 **C++11 及之后的标准中**，RAII 思想被广泛应用到标准库中，开发者无需自己额外编写管理类即可安全高效地管理资源。例如：

- **内存管理**：`std::unique_ptr`, `std::shared_ptr`
- **文件操作**：`std::ifstream`（构造时打开文件，析构时关闭文件）
- **互斥锁**：`std::lock_guard`, `std::unique_lock`
- **数据库连接**：获取连接时构造，归还连接时析构



在这个数据库连接池中，要手动写一个类**connectionRAII**，用于数据库连接的释放



## 参数

### Mysql类型

​	<img src="C:\Users\王者荣耀\AppData\Roaming\Typora\typora-user-images\image-20251003173402563.png" alt="image-20251003173402563" style="zoom: 50%;" />

## 数据池初始化：init

init() 初始化流程
↓
保存数据库配置信息
↓
循环 MaxConn 次：
  ├── 调用 mysql_init()   ---->这里是将每个连接初始化
  ├── 调用 mysql_real_connect() 建立连接
  ├── 放入连接池 connList
↓
初始化信号量 reserve
↓
记录最大连接数
↓
完成



### my_init函数

<img src="C:\Users\王者荣耀\AppData\Roaming\Typora\typora-user-images\image-20251004171055116.png" alt="image-20251004171055116" style="zoom:50%;" />

所以在使用时，要有接受对象

​	

```
MYSQL * conn  =NULL;
conn = mysql_init(conn);
```

### mysql_real_connect()函数

也需要有接受对象，类型为MYSQL *
